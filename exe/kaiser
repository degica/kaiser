#!/usr/bin/env ruby

require 'optimist'
require 'fileutils'
require 'yaml'
require 'json'
require 'pty'
require 'erb'

require 'kaiser'

SUB_COMMANDS = %w[init deinit up down shutdown db_load db_save logs attach].freeze
opts = Optimist.options do
  banner <<-BANNER
Kaiser v#{Kaiser::VERSION}

Subcommands:
#{SUB_COMMANDS}
  BANNER
  opt :verbose, "Show Kaiser's debug output", short: '-v'
  opt :quiet, 'Suppress all output', short: '-q'
  stop_on SUB_COMMANDS
end

cmd = ARGV.shift
Optimist::die "Unknown command: #{cmd}" unless SUB_COMMANDS.include?(cmd)

out = File.open(File::NULL, 'w')
info_out = $stderr
if opts[:quiet]
  info_out = File.open(File::NULL, 'w')
elsif opts[:verbose]
  out = $stderr
end
cli = Kaiser::KaiserCli.new(
  `pwd`.chomp,
  debug_output: out,
  info_output: info_out
)
cli.send(:"#{cmd}")
